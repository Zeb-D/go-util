package dubbo

import (
	"encoding/base64"
	"fmt"
	hessian "github.com/apache/dubbo-go-hessian2"
	"github.com/stretchr/testify/assert"
	"testing"
)

const DATA = "lE0XamF2YS51dGlsLkxpbmtlZEhhc2hNYXAHc3VjY2Vzc1QGc3RhdHVzAm9rCWVycm9yQ29kZU4IZXJyb3JNc2cAAXRMAAABdkAnD3YGcmVzdWx0SAV0b3RhbNQPBAhkYXRhTGlzdHYTamF2YS51dGlsLkFycmF5TGlzdEgGcmVhc29uAAtnbXRNb2RpZmllZA0xNjA3MzkzMDE4MzEzB3NrdUxpc3RxkUgLZ210TW9kaWZpZWROD2V4dGVybmFsU2t1Q29kZQAGd2VpZ2h0QxRqYXZhLm1hdGguQmlnRGVjaW1hbJEFdmFsdWVgATAJZ210Q3JlYXRlTgVwcmljZQMxMDAKZ3JvdXBQcmljZU4CaWROBXN0b2NrmgVjbGFzczA4Y29tLnR1eWEudGlhbmRpLmNsaWVudC5jb21tb2RpdHkubW9kZWwuQ29tbW9kaXR5U2t1TW9kZWwQc2t1QXR0clZhbHVlTGlzdHGRSAtnbXRNb2RpZmllZE4IYXR0ckNvZGUMeGp0aDM1YkdTOUlNC2F0dHJWYWx1ZUlk++0JYXR0clZhbHVlA+ebtOa1geeUtQJpZE4JZ210Q3JlYXRlTgVjbGFzczA8Y29tLnR1eWEudGlhbmRpLmNsaWVudC5jb21tb2RpdHkubW9kZWwuQ29tbW9kaXR5U2t1QXR0ck1vZGVsCGF0dHJOYW1lBOS+m+eUteaWueW8jwhhdHRyVHlwZZBaC3JldGFpbFByaWNlAzEwMAdza3VDb2RlDlNLYTVnMmFzMGI5bGluCXN0b2NrU29sZJAMc3VnZ2VzdFByaWNlAzEwMFoObWF4U291cmNlUHJpY2XIZANwaWQAC21haW5QaWN0dXJlMCNlY29tbWVyY2UvMTU4MzMyMzM2MjljYTViODNiMjk2LmpwZwV0aXRsZRBBdXRvVGVzdDI1MzQ1MTkxC21heFNrdVN0b2NrTg9tYXhTdWdnZXN0UHJpY2XIZAhmcm9tTWFsbAl0ZXN0X2NvZGUPY29tbW9kaXR5U3RhdHVzkA1jb21tb2RpdHlDb2RlDkNNYTVnMmFyendhN2hjDGZyZWV6ZVN0YXR1c5AIZnJvbVNlbGaQBXN0b2NrmgVjbGFzczA5Y29tLnR1eWEudGlhbmRpLmFwYWFzLmNvbW1vZGl0eS5tb2RlbC5Db21tb2RpdHlMaXN0UmVzdWx0CXN0b2NrU29sZJAPbWluU3VnZ2VzdFByaWNlyGQHY3JlYXRvck4SY2F0ZWdvcnlMZXZlbDNOYW1lA+eUtemlreeFsglnbXRDcmVhdGVMAAABdkAXAckMZ2lmdEFjdGl2aXR5Tg5taW5SZXRhaWxQcmljZchkDm1pblNvdXJjZVByaWNlyGQIbWluUHJpY2XIZBJjYXRlZ29yeUxldmVsMU5hbWUD5bCP5a6255S1B3B1Ymxpc2iREmNhdGVnb3J5TGV2ZWwyTmFtZQTljqjmiL/nlLXlmagLYXVkaXRTdGF0dXOSCG1heFByaWNlyGQObWF4UmV0YWlsUHJpY2XIZFpIBnJlYXNvbgALZ210TW9kaWZpZWQNMTYwNzM5Mjk2MjY1MQdza3VMaXN0cZFIC2dtdE1vZGlmaWVkTg9leHRlcm5hbFNrdUNvZGUABndlaWdodFGWCWdtdENyZWF0ZU4FcHJpY2UDMTAwCmdyb3VwUHJpY2VOAmlkTgVzdG9ja5oFY2xhc3MwOGNvbS50dXlhLnRpYW5kaS5jbGllbnQuY29tbW9kaXR5Lm1vZGVsLkNvbW1vZGl0eVNrdU1vZGVsEHNrdUF0dHJWYWx1ZUxpc3RxkUgLZ210TW9kaWZpZWROCGF0dHJDb2RlDHhqdGgzNWJHUzlJTQthdHRyVmFsdWVJZPvtCWF0dHJWYWx1ZQPnm7TmtYHnlLUCaWROCWdtdENyZWF0ZU4FY2xhc3MwPGNvbS50dXlhLnRpYW5kaS5jbGllbnQuY29tbW9kaXR5Lm1vZGVsLkNvbW1vZGl0eVNrdUF0dHJNb2RlbAhhdHRyTmFtZQTkvpvnlLXmlrnlvI8IYXR0clR5cGWQWgtyZXRhaWxQcmljZQMxMDAHc2t1Q29kZQ5TS2E1ZzI3c3I0N3ptMglzdG9ja1NvbGSQDHN1Z2dlc3RQcmljZQMxMDBaDm1heFNvdXJjZVByaWNlyGQDcGlkAAttYWluUGljdHVyZTAjZWNvbW1lcmNlLzE1ODMzMjMzNjI5Y2E1YjgzYjI5Ni5qcGcFdGl0bGUQQXV0b1Rlc3QzNDYyMzg5MAttYXhTa3VTdG9ja04PbWF4U3VnZ2VzdFByaWNlyGQIZnJvbU1hbGwJdGVzdF9jb2RlD2NvbW1vZGl0eVN0YXR1c5ANY29tbW9kaXR5Q29kZQ5DTWE1ZzI3c3F3cWFscwxmcmVlemVTdGF0dXOQCGZyb21TZWxmkAVzdG9ja5oFY2xhc3MwOWNvbS50dXlhLnRpYW5kaS5hcGFhcy5jb21tb2RpdHkubW9kZWwuQ29tbW9kaXR5TGlzdFJlc3VsdAlzdG9ja1NvbGSQD21pblN1Z2dlc3RQcmljZchkB2NyZWF0b3JOEmNhdGVnb3J5TGV2ZWwzTmFtZQPnlLXppa3nhbIJZ210Q3JlYXRlTAAAAXZAFihbDGdpZnRBY3Rpdml0eU4ObWluUmV0YWlsUHJpY2XIZA5taW5Tb3VyY2VQcmljZchkCG1pblByaWNlyGQSY2F0ZWdvcnlMZXZlbDFOYW1lA+Wwj+WutueUtQdwdWJsaXNokRJjYXRlZ29yeUxldmVsMk5hbWUE5Y6o5oi/55S15ZmoC2F1ZGl0U3RhdHVzkghtYXhQcmljZchkDm1heFJldGFpbFByaWNlyGRaSAZyZWFzb24AC2dtdE1vZGlmaWVkDTE2MDczOTI4OTQ4NjQHc2t1TGlzdHGRSAtnbXRNb2RpZmllZE4PZXh0ZXJuYWxTa3VDb2RlAAZ3ZWlnaHRRlglnbXRDcmVhdGVOBXByaWNlAzEwMApncm91cFByaWNlTgJpZE4Fc3RvY2uaBWNsYXNzMDhjb20udHV5YS50aWFuZGkuY2xpZW50LmNvbW1vZGl0eS5tb2RlbC5Db21tb2RpdHlTa3VNb2RlbBBza3VBdHRyVmFsdWVMaXN0cZFIC2dtdE1vZGlmaWVkTghhdHRyQ29kZQx4anRoMzViR1M5SU0LYXR0clZhbHVlSWT77QlhdHRyVmFsdWUD55u05rWB55S1AmlkTglnbXRDcmVhdGVOBWNsYXNzMDxjb20udHV5YS50aWFuZGkuY2xpZW50LmNvbW1vZGl0eS5tb2RlbC5Db21tb2RpdHlTa3VBdHRyTW9kZWwIYXR0ck5hbWUE5L6b55S15pa55byPCGF0dHJUeXBlkFoLcmV0YWlsUHJpY2UDMTAwB3NrdUNvZGUOU0thNWcyNDY0eGQycXoJc3RvY2tTb2xkkAxzdWdnZXN0UHJpY2UDMTAwWg5tYXhTb3VyY2VQcmljZchkA3BpZAALbWFpblBpY3R1cmUwI2Vjb21tZXJjZS8xNTgzMzIzMzYyOWNhNWI4M2IyOTYuanBnBXRpdGxlEEF1dG9UZXN0ODQ4MDk3MTALbWF4U2t1U3RvY2tOD21heFN1Z2dlc3RQcmljZchkCGZyb21NYWxsCXRlc3RfY29kZQ9jb21tb2RpdHlTdGF0dXOQDWNvbW1vZGl0eUNvZGUOQ01hNWcyNDY0c2RhMmcMZnJlZXplU3RhdHVzkAhmcm9tU2VsZpAFc3RvY2uaBWNsYXNzMDljb20udHV5YS50aWFuZGkuYXBhYXMuY29tbW9kaXR5Lm1vZGVsLkNvbW1vZGl0eUxpc3RSZXN1bHQJc3RvY2tTb2xkkA9taW5TdWdnZXN0UHJpY2XIZAdjcmVhdG9yThJjYXRlZ29yeUxldmVsM05hbWUD55S16aWt54WyCWdtdENyZWF0ZUwAAAF2QBUfkAxnaWZ0QWN0aXZpdHlODm1pblJldGFpbFByaWNlyGQObWluU291cmNlUHJpY2XIZAhtaW5QcmljZchkEmNhdGVnb3J5TGV2ZWwxTmFtZQPlsI/lrrbnlLUHcHVibGlzaJESY2F0ZWdvcnlMZXZlbDJOYW1lBOWOqOaIv+eUteWZqAthdWRpdFN0YXR1c5IIbWF4UHJpY2XIZA5tYXhSZXRhaWxQcmljZchkWkgGcmVhc29uAAtnbXRNb2RpZmllZA0xNjA3MzkyODUyMDA0B3NrdUxpc3RxkUgLZ210TW9kaWZpZWROD2V4dGVybmFsU2t1Q29kZQAGd2VpZ2h0UZYJZ210Q3JlYXRlTgVwcmljZQMxMDAKZ3JvdXBQcmljZU4CaWROBXN0b2NrmgVjbGFzczA4Y29tLnR1eWEudGlhbmRpLmNsaWVudC5jb21tb2RpdHkubW9kZWwuQ29tbW9kaXR5U2t1TW9kZWwQc2t1QXR0clZhbHVlTGlzdHGRSAtnbXRNb2RpZmllZE4IYXR0ckNvZGUMeGp0aDM1YkdTOUlNC2F0dHJWYWx1ZUlk++0JYXR0clZhbHVlA+ebtOa1geeUtQJpZE4JZ210Q3JlYXRlTgVjbGFzczA8Y29tLnR1eWEudGlhbmRpLmNsaWVudC5jb21tb2RpdHkubW9kZWwuQ29tbW9kaXR5U2t1QXR0ck1vZGVsCGF0dHJOYW1lBOS+m+eUteaWueW8jwhhdHRyVHlwZZBaC3JldGFpbFByaWNlAzEwMAdza3VDb2RlDlNLYTVnMjF2anc3cXoyCXN0b2NrU29sZJAMc3VnZ2VzdFByaWNlAzEwMFoObWF4U291cmNlUHJpY2XIZANwaWQAC21haW5QaWN0dXJlMCNlY29tbWVyY2UvMTU4MzMyMzM2MjljYTViODNiMjk2LmpwZwV0aXRsZRBBdXRvVGVzdDkzMjM3NDg3C21heFNrdVN0b2NrTg9tYXhTdWdnZXN0UHJpY2XIZAhmcm9tTWFsbAl0ZXN0X2NvZGUPY29tbW9kaXR5U3RhdHVzkA1jb21tb2RpdHlDb2RlDkNNYTVnMjF2anI3eWFxDGZyZWV6ZVN0YXR1c5AIZnJvbVNlbGaQBXN0b2NrmgVjbGFzczA5Y29tLnR1eWEudGlhbmRpLmFwYWFzLmNvbW1vZGl0eS5tb2RlbC5Db21tb2RpdHlMaXN0UmVzdWx0CXN0b2NrU29sZJAPbWluU3VnZ2VzdFByaWNlyGQHY3JlYXRvck4SY2F0ZWdvcnlMZXZlbDNOYW1lA+eUtemlreeFsglnbXRDcmVhdGVMAAABdkAUeCQMZ2lmdEFjdGl2aXR5Tg5taW5SZXRhaWxQcmljZchkDm1pblNvdXJjZVByaWNlyGQIbWluUHJpY2XIZBJjYXRlZ29yeUxldmVsMU5hbWUD5bCP5a6255S1B3B1Ymxpc2iREmNhdGVnb3J5TGV2ZWwyTmFtZQTljqjmiL/nlLXlmagLYXVkaXRTdGF0dXOSCG1heFByaWNlyGQObWF4UmV0YWlsUHJpY2XIZFpIBnJlYXNvbgALZ210TW9kaWZpZWQNMTYwNzM5MTE5Njc2Ngdza3VMaXN0cZFIC2dtdE1vZGlmaWVkTg9leHRlcm5hbFNrdUNvZGUABndlaWdodFGWCWdtdENyZWF0ZU4FcHJpY2UDMTAwCmdyb3VwUHJpY2VOAmlkTgVzdG9ja5oFY2xhc3MwOGNvbS50dXlhLnRpYW5kaS5jbGllbnQuY29tbW9kaXR5Lm1vZGVsLkNvbW1vZGl0eVNrdU1vZGVsEHNrdUF0dHJWYWx1ZUxpc3RxkUgLZ210TW9kaWZpZWROCGF0dHJDb2RlDHhqdGgzNWJHUzlJTQthdHRyVmFsdWVJZPvtCWF0dHJWYWx1ZQPnm7TmtYHnlLUCaWROCWdtdENyZWF0ZU4FY2xhc3MwPGNvbS50dXlhLnRpYW5kaS5jbGllbnQuY29tbW9kaXR5Lm1vZGVsLkNvbW1vZGl0eVNrdUF0dHJNb2RlbAhhdHRyTmFtZQTkvpvnlLXmlrnlvI8IYXR0clR5cGWQWgtyZXRhaWxQcmljZQMxMDAHc2t1Q29kZQ5TS2E1ZnpsYTZnaDV2awlzdG9ja1NvbGSQDHN1Z2dlc3RQcmljZQMxMDBaDm1heFNvdXJjZVByaWNlyGQDcGlkAAttYWluUGljdHVyZTAjZWNvbW1lcmNlLzE1ODMzMjMzNjI5Y2E1YjgzYjI5Ni5qcGcFdGl0bGUQQXV0b1Rlc3Q3ODYzMTE5NwttYXhTa3VTdG9ja04PbWF4U3VnZ2VzdFByaWNlyGQIZnJvbU1hbGwJdGVzdF9jb2RlD2NvbW1vZGl0eVN0YXR1c5ANY29tbW9kaXR5Q29kZQ5DTWE1ZnpsYTY4emd2cwxmcmVlemVTdGF0dXOQCGZyb21TZWxmkAVzdG9ja5oFY2xhc3MwOWNvbS50dXlhLnRpYW5kaS5hcGFhcy5jb21tb2RpdHkubW9kZWwuQ29tbW9kaXR5TGlzdFJlc3VsdAlzdG9ja1NvbGSQD21pblN1Z2dlc3RQcmljZchkB2NyZWF0b3JOEmNhdGVnb3J5TGV2ZWwzTmFtZQPnlLXppa3nhbIJZ210Q3JlYXRlTAAAAXY/+zZeDGdpZnRBY3Rpdml0eU4ObWluUmV0YWlsUHJpY2XIZA5taW5Tb3VyY2VQcmljZchkCG1pblByaWNlyGQSY2F0ZWdvcnlMZXZlbDFOYW1lA+Wwj+WutueUtQdwdWJsaXNokRJjYXRlZ29yeUxldmVsMk5hbWUE5Y6o5oi/55S15ZmoC2F1ZGl0U3RhdHVzkghtYXhQcmljZchkDm1heFJldGFpbFByaWNlyGRaSAZyZWFzb24AC2dtdE1vZGlmaWVkDTE2MDczODkzOTQ3MzEHc2t1TGlzdHGRSAtnbXRNb2RpZmllZE4PZXh0ZXJuYWxTa3VDb2RlAAZ3ZWlnaHRRlglnbXRDcmVhdGVOBXByaWNlAzEwMApncm91cFByaWNlTgJpZE4Fc3RvY2uaBWNsYXNzMDhjb20udHV5YS50aWFuZGkuY2xpZW50LmNvbW1vZGl0eS5tb2RlbC5Db21tb2RpdHlTa3VNb2RlbBBza3VBdHRyVmFsdWVMaXN0cZFIC2dtdE1vZGlmaWVkTghhdHRyQ29kZQx4anRoMzViR1M5SU0LYXR0clZhbHVlSWT77QlhdHRyVmFsdWUD55u05rWB55S1AmlkTglnbXRDcmVhdGVOBWNsYXNzMDxjb20udHV5YS50aWFuZGkuY2xpZW50LmNvbW1vZGl0eS5tb2RlbC5Db21tb2RpdHlTa3VBdHRyTW9kZWwIYXR0ck5hbWUE5L6b55S15pa55byPCGF0dHJUeXBlkFoLcmV0YWlsUHJpY2UDMTAwB3NrdUNvZGUOU0thNWZ3d3R5dTR6MGkJc3RvY2tTb2xkkAxzdWdnZXN0UHJpY2UDMTAwWg5tYXhTb3VyY2VQcmljZchkA3BpZAALbWFpblBpY3R1cmUwI2Vjb21tZXJjZS8xNTgzMzIzMzYyOWNhNWI4M2IyOTYuanBnBXRpdGxlEEF1dG9UZXN0ODk4MTcxMTMLbWF4U2t1U3RvY2tOD21heFN1Z2dlc3RQcmljZchkCGZyb21NYWxsCXRlc3RfY29kZQ9jb21tb2RpdHlTdGF0dXOQDWNvbW1vZGl0eUNvZGUOQ01hNWZ3d3R5NTV6anQMZnJlZXplU3RhdHVzkAhmcm9tU2VsZpAFc3RvY2uaBWNsYXNzMDljb20udHV5YS50aWFuZGkuYXBhYXMuY29tbW9kaXR5Lm1vZGVsLkNvbW1vZGl0eUxpc3RSZXN1bHQJc3RvY2tTb2xkkA9taW5TdWdnZXN0UHJpY2XIZAdjcmVhdG9yThJjYXRlZ29yeUxldmVsM05hbWUD55S16aWt54WyCWdtdENyZWF0ZUwAAAF2P9+3KwxnaWZ0QWN0aXZpdHlODm1pblJldGFpbFByaWNlyGQObWluU291cmNlUHJpY2XIZAhtaW5QcmljZchkEmNhdGVnb3J5TGV2ZWwxTmFtZQPlsI/lrrbnlLUHcHVibGlzaJESY2F0ZWdvcnlMZXZlbDJOYW1lBOWOqOaIv+eUteWZqAthdWRpdFN0YXR1c5IIbWF4UHJpY2XIZA5tYXhSZXRhaWxQcmljZchkWghwYWdlU2l6ZZYEcGFnZZEFY2xhc3MwK2NvbS50dXlhLnRpYW5kaS5hcGFhcy51dGlsLlBhZ2luYXRpb25SZXN1bHRaA3RhZwxTSEVOQ0xJOlJFU1BaSAZvdXRwdXQDNTY2BWR1YmJvBTIuMC4yWg=="

func TestDubboHessian(t *testing.T) {
	bytes, err := base64.StdEncoding.DecodeString(DATA)
	assert.Nil(t, err)
	fmt.Println(bytes)

	// demo a decoder to decode buffer from client
	d := hessian.NewDecoder(bytes)
	lengthObj, _ := d.Decode()
	assert.True(t, lengthObj == int32(4))
	length := lengthObj.(int32)
	fmt.Println(length)
	fmt.Println("resp")
	o, err := d.DecodeValue()
	if err != nil {
		fmt.Println(err)
	}
	fmt.Println(o)

	o, err = d.DecodeValue()
	if err != nil {
		fmt.Println(err)
	}
	fmt.Println("att")
	fmt.Println(o)
}
